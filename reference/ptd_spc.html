<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SPC Plotting Function — ptd_spc • NHSRplotthedots</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="SPC Plotting Function — ptd_spc" />
<meta property="og:description" content="ptd_spc returns a plot object or data table with SPC values using NHSI 'plot the dots' logic." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NHSRplotthedots</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/deviations.html">Deviations from excel defaults</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction to the `NHSRplotthedots` package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>SPC Plotting Function</h1>
    
    <div class="hidden name"><code>ptd_spc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>ptd_spc</code> returns a plot object or data table with SPC values using NHSI 'plot the dots' logic.</p>
    </div>

    <pre class="usage"><span class='fu'>ptd_spc</span><span class='op'>(</span>
  <span class='va'>.data</span>,
  <span class='va'>value_field</span>,
  <span class='va'>date_field</span>,
  <span class='va'>facet_field</span>,
  rebase <span class='op'>=</span> <span class='fu'><a href='ptd_rebase.html'>ptd_rebase</a></span><span class='op'>(</span><span class='op'>)</span>,
  fix_after_n_points <span class='op'>=</span> <span class='cn'>NULL</span>,
  improvement_direction <span class='op'>=</span> <span class='st'>"increase"</span>,
  target <span class='op'>=</span> <span class='fu'><a href='ptd_target.html'>ptd_target</a></span><span class='op'>(</span><span class='op'>)</span>,
  <span class='va'>trajectory</span>,
  screen_outliers <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>.data</th>
      <td><p>A data frame containing a value field, a date field,
and a category field (if for faceting). There should be no gaps in the time series
for each category.</p></td>
    </tr>
    <tr>
      <th>value_field</th>
      <td><p>Specify the field name which contains the value data, to be plotted on y axis.
Field name can be specified using non-standard evaluation (i.e. no quotation marks).</p></td>
    </tr>
    <tr>
      <th>date_field</th>
      <td><p>Specify the field name which contains the date data, to be plotted on x axis.
Field name can be specified using non-standard evaluation (i.e. no quotation marks).</p></td>
    </tr>
    <tr>
      <th>facet_field</th>
      <td><p>Optional: Specify field name which contains a grouping/faceting variable. SPC logic will be
applied to each group separately, with outputs combined. Currently accepts 1 variable only.
Field name can be specified using non-standard evaluation (i.e. no quotation marks).</p></td>
    </tr>
    <tr>
      <th>rebase</th>
      <td><p>Specify a date vector of dates when to rebase, or, if facet_field is set, a named list of date vectors
of when to rebase. Each item in the list should be named after the facet you wish to rebase. See <code><a href='ptd_rebase.html'>ptd_rebase()</a></code>.</p></td>
    </tr>
    <tr>
      <th>fix_after_n_points</th>
      <td><p>Specify a number points after which to fix SPC calculations.</p></td>
    </tr>
    <tr>
      <th>improvement_direction</th>
      <td><p>Specify whether process improvement is represented by an increase or decrease in
measured variable, or is neutral.  Accepted values are 'increase' for increase as improvement, 'decrease' for
decrease as improvement, and 'neutral' where neither direction represents an improvement. Defaults to 'increase'.</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>Specify a single value, which will apply the same target to every facet of an SPC chart,
or named values of targets, where the names correspond to the names of the facets, in order to
have different targets for each facet. See <code><a href='ptd_target.html'>ptd_target()</a></code>.</p></td>
    </tr>
    <tr>
      <th>trajectory</th>
      <td><p>Specify a field name which contains a trajectory value.
Field name can be specified using non-standard evaluation (i.e. no quotation marks).</p></td>
    </tr>
    <tr>
      <th>screen_outliers</th>
      <td><p>Whether we should screen for outliers or not when calculating the control limits. Defaults to
<code>TRUE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A ggplot2 object of the spc charts.  This will automatically print the plot, but can also be saved as an
object if you want to manipulate it further.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function is designed to produce consistent SPC charts
across Information Department reporting, according to the 'plot the dots'
logic produced by NHSI. The function can return either a plot or data frame.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/nhs-r-community/NHSRdatasets'>NHSRdatasets</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘dplyr’</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    filter, lag</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    intersect, setdiff, setequal, union</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"ae_attendances"</span><span class='op'>)</span>

<span class='co'># Pick a trust at random to look at their data for two years</span>
<span class='va'>trust1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>ae_attendances</span>, <span class='va'>org_code</span> <span class='op'>==</span> <span class='st'>"RJZ"</span> <span class='op'>&amp;</span> <span class='va'>type</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='co'># Basic chart with improvement direction decreasing</span>
<span class='fu'>ptd_spc</span><span class='op'>(</span><span class='va'>trust1</span>,
  value_field <span class='op'>=</span> <span class='va'>breaches</span>, date_field <span class='op'>=</span> <span class='va'>period</span>,
  improvement_direction <span class='op'>=</span> <span class='st'>"decrease"</span>
<span class='op'>)</span>
</div><div class='img'><img src='ptd_spc-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Pick a few trust, and plot individually using facet</span>
<span class='co'># Also set the x-axis scale to vary for each and date groups to 3 months</span>
<span class='va'>orgs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"RAS"</span>, <span class='st'>"RJZ"</span>, <span class='st'>"RR1"</span>, <span class='st'>"RJC"</span>, <span class='st'>"RQ1"</span><span class='op'>)</span>
<span class='va'>trusts4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>ae_attendances</span>, <span class='va'>org_code</span> <span class='op'>%in%</span> <span class='va'>orgs</span>, <span class='va'>type</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'>ptd_spc</span><span class='op'>(</span><span class='va'>trusts4</span>,
  value_field <span class='op'>=</span> <span class='va'>breaches</span>, date_field <span class='op'>=</span> <span class='va'>period</span>, facet_field <span class='op'>=</span> <span class='va'>org_code</span>,
  improvement_direction <span class='op'>=</span> <span class='st'>"decrease"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>s</span>, fixed_y_axis_multiple <span class='op'>=</span> <span class='cn'>FALSE</span>, x_axis_breaks <span class='op'>=</span> <span class='st'>"3 months"</span><span class='op'>)</span>
</div><div class='img'><img src='ptd_spc-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Save the first chart as an object this time then alter the ggplot theme</span>
<span class='va'>my_spc</span> <span class='op'>&lt;-</span> <span class='fu'>ptd_spc</span><span class='op'>(</span><span class='va'>trust1</span>,
  value_field <span class='op'>=</span> <span class='st'>"breaches"</span>, date_field <span class='op'>=</span> <span class='st'>"period"</span>,
  improvement_direction <span class='op'>=</span> <span class='st'>"decrease"</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>my_spc</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='img'><img src='ptd_spc-3.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Christopher Reading, Simon Wellesley-Miller, Zoë Turner, Tom Jemmett, Tom Smith, Chris Mainey, John MacKintosh.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


