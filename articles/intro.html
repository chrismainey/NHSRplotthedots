<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the `NHSRplotthedots` package • NHSRplotthedots</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the `NHSRplotthedots` package">
<meta property="og:description" content="NHSRplotthedots">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NHSRplotthedots</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to the `NHSRplotthedots` package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the <code>NHSRplotthedots</code> package</h1>
            
      
      
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<p><strong><em>This vignette is a work in progress, feel free to contribute on NHS-R GitHub</em></strong></p>
<p>Welcome to the NHS-R community’s collaborative package for building a specific type of statistical process control (SPC) chart, the XmR chart. We are aiming to support the NHS England and NHS Improvement’s ‘Making Data Count’ programme, please see <a href="https://www.england.nhs.uk/a-focus-on-staff-health-and-wellbeing/publications-and-resources/making-data-count/"> here </a> for more details. The programme encourages boards, managers, and analyst teams to present data in ways that show change over time, and drive better understanding of indicators than ‘RAG’ (red, amber, green) rated board reports often present.</p>
<p>This tutorial is a concise take on applying the function to some Accident and Emergency breach data for some NHS hospitals. We’ll take this from the <code>NHSRdatasets</code> package, another of our packages providing example datasets for training in an NHS/healthcare context.</p>
<p>The analyses below use the <code>tidyverse</code> packages: <code>dplyr</code> to manipulate the data, and <code>gggplot2</code> for plotting (when not using <code>NHSRplotthedots</code>).</p>
<p>Firstly, lets load the data, filter for University Hospital Birmingham NHS Foundation Trust, because they are a good example for the type of charts below. Let’s also do a simple timeseries plot to see why this is the case.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://nhs-r-community.github.io/NHSRplotthedots/">NHSRplotthedots</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nhs-r-community/NHSRdatasets">NHSRdatasets</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"ae_attendances"</span><span class="op">)</span>

<span class="va">ae_attendances</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">org_code</span> <span class="op">==</span> <span class="st">'RRK'</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">period</span>, y<span class="op">=</span> <span class="va">breaches</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span><span class="st">"4-hour target breaches"</span>, labels<span class="op">=</span><span class="va">comma</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Example plot of A&amp;E breaches for organsiation: 'RRK'"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="intro_files/figure-html/dataset-1.png" width="672"></p>
<p>This minimal plot shows the changes over time, and we will look at it in two ways. The first, we’ll look at 2016/17 &amp; 2017/18, which is apparently stable and, during 2018, the trust merged with another large 3-hospital provider trust, so the numbers through A&amp;E shot up dramatically when combined under one trust code. We can use a change point in our plots to consider this.</p>
<p>Let’s now use the <code>spc</code> function to draw our plot. We need to provide it with a <code>data.frame</code> that contains our data, and provide a <code>valueField</code> for the y-axis, and a <code>dateField</code> for the x-axis. Remember to surround the names of the columns in the <code>data.frame</code> with quotes (making it a string, see below). In addition, to ensure the points are coloured correctly, we need to set the improvement direction to “decrease” using the <code>options</code> parameter.</p>
<div id="stable-period" class="section level2">
<h2 class="hasAnchor">
<a href="#stable-period" class="anchor"></a>Stable period</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stable_set</span> <span class="op">&lt;-</span> 
  <span class="va">ae_attendances</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">org_code</span> <span class="op">==</span> <span class="st">'RRK'</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">period</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">'2018-04-01'</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/spc.html">spc</a></span><span class="op">(</span><span class="va">stable_set</span>, valueField <span class="op">=</span> <span class="st">"breaches"</span>, dateField <span class="op">=</span> <span class="st">"period"</span>, options <span class="op">=</span> <span class="fu"><a href="../reference/spcOptions.html">spcOptions</a></span><span class="op">(</span>improvementDirection <span class="op">=</span> <span class="st">"decrease"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 24 row(s) containing missing values (geom_path).</span>

<span class="co">#&gt; Warning: Removed 24 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Warning: Removed 16 rows containing missing values (geom_point).</span>
<span class="co">#&gt; Warning: Removed 24 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="intro_files/figure-html/stableperiod-1.png" width="672"></p>
<p>From the chart above, we can see the centre line (mean) and the control limits calculated according the the XmR chart rules. Our points that are between the control limits are within control and showing ‘common-cause’ or ‘natural’ variation. We can see 8 sequential points coloured in yellow. This is triggered by a rule that looks for &gt;=7 points on one side of the mean. This could be viewed as a period where fewer breaches than average were detected, which may hold some learning value for the organisation.</p>
</div>
<div id="change-point" class="section level2">
<h2 class="hasAnchor">
<a href="#change-point" class="anchor"></a>Change point</h2>
<p>From the first plot above, we can see that the change is noticed at 01/07/2019. We understand the reason for the change (the merging of several trusts), and believe this will be the new normal range for the process, so it would be valid to rebase at this point. To rebase (change the modelling period for control limits), we need to set a binary flag here in our data (achieved with the <code>mutate</code> statement below). We’ve now got an extra column, all set to 0, except 01/07/2019, which is set to 1 to trigger the rebase here. This is then passed to the <code>options</code> argument. You can pass a list with the named elements to <code>options</code>, but it’s probably best to use the helper function <code>spcOptions</code>. You can view the help file, and see what the options are using: <code><a href="../reference/spcOptions.html">?spcOptions</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">change_set</span> <span class="op">&lt;-</span> 
  <span class="va">ae_attendances</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">org_code</span> <span class="op">==</span> <span class="st">'RRK'</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rebased <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">period</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-07-01"</span><span class="op">)</span>, <span class="fl">1</span> , <span class="fl">0</span><span class="op">)</span><span class="op">)</span>


<span class="fu"><a href="../reference/spc.html">spc</a></span><span class="op">(</span><span class="va">change_set</span>, valueField <span class="op">=</span> <span class="st">"breaches"</span>, dateField <span class="op">=</span> <span class="st">"period"</span>, options <span class="op">=</span> <span class="fu"><a href="../reference/spcOptions.html">spcOptions</a></span><span class="op">(</span>improvementDirection <span class="op">=</span> <span class="st">"decrease"</span>, rebase <span class="op">=</span> <span class="st">"rebased"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 36 row(s) containing missing values (geom_path).</span>

<span class="co">#&gt; Warning: Removed 36 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Warning: Removed 25 rows containing missing values (geom_point).</span>
<span class="co">#&gt; Warning: Removed 33 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="intro_files/figure-html/changepoint-1.png" width="672"></p>
<p>You can see that our limit calculation has now shifted at the rebase point.</p>
</div>
<div id="faceting" class="section level2">
<h2 class="hasAnchor">
<a href="#faceting" class="anchor"></a>Faceting</h2>
<p>In <code>R</code> <code>ggplot2</code> system, <code>facet</code> refers to splitting or plotting by variables, into separate plots or regions. Imagine you want to do an SPC for all trusts in a dataset, or all specialties at a trust. Facet will help you do this, and you can pass the field that controls this to the <code>spc</code> argument <code>facetField</code>.</p>
<p>Here we will pick 6 trusts at random and plot their breaches, faceting across them. We’ll also combine this with a couple more <code>options</code>: letting the x-axis scale for each plot (otherwise some would look crushed against a larger trusts, and changing the x-axis breaks to 3-months, as 1 month looked too busy.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">facet_set</span> <span class="op">&lt;-</span> 
  <span class="va">ae_attendances</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">org_code</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'RRK'</span>, <span class="st">'RJC'</span>, <span class="st">'RJ7'</span>, <span class="st">'R1K'</span>, <span class="st">'R1H'</span>, <span class="st">'RQM'</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span><span class="fl">1</span><span class="op">&amp;</span> <span class="va">period</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">'2018-04-01'</span><span class="op">)</span><span class="op">)</span>


<span class="fu"><a href="../reference/spc.html">spc</a></span><span class="op">(</span><span class="va">facet_set</span>, valueField <span class="op">=</span> <span class="st">"breaches"</span>, dateField <span class="op">=</span> <span class="st">"period"</span>, facetField <span class="op">=</span> <span class="st">"org_code"</span>
    , options <span class="op">=</span> <span class="fu"><a href="../reference/spcOptions.html">spcOptions</a></span><span class="op">(</span>improvementDirection <span class="op">=</span> <span class="st">"decrease"</span>, fixedYAxisMultiple <span class="op">=</span> <span class="cn">FALSE</span>, xAxisBreaks <span class="op">=</span> <span class="st">"3 months"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 144 row(s) containing missing values (geom_path).</span>

<span class="co">#&gt; Warning: Removed 144 row(s) containing missing values (geom_path).</span>
<span class="co">#&gt; Warning: Removed 94 rows containing missing values (geom_point).</span>
<span class="co">#&gt; Warning: Removed 122 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="intro_files/figure-html/facetvignette-1.png" width="672"></p>
</div>
<div id="come-and-join-us" class="section level2">
<h2 class="hasAnchor">
<a href="#come-and-join-us" class="anchor"></a>Come and join us!</h2>
<p>This is a collaborative project that is still early in it’s life. All contributors are volunteers, and more volunteers would be very welcome (there’s even stuff that doesn’t require <code>R</code> coding to help with!). Find out more at: <a href="https://github.com/nhs-r-community/NHSRplotthedots" class="uri">https://github.com/nhs-r-community/NHSRplotthedots</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Reading, Simon Wellesley-Miller, Zoë Turner, Tom Jemmett, Tom Smith, Chris Mainey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
